# Ticket PHASE-3-BUGS: Исправление багов Фазы 3

**Дата создания:** 2025-12-27
**Приоритет:** КРИТИЧЕСКИЙ
**Фаза:** 3 - Миграция данных в Supabase
**Назначено:** Веб-агент (удаленный Claude Code)

---

## Описание

После интеграции Supabase в Фазе 3 найдены критические баги, которые блокируют использование приложения.

**Текущая ситуация:**
- Приложение запускается на `http://localhost:3000` ✅
- Supabase подключение работает ✅
- Auth работает ✅
- **НО:** Основной функционал не работает ❌

---

## Список багов для исправления

### 1. Drag & Drop не работает (КРИТИЧЕСКИЙ)

**Проблема:** Задачи не перетаскиваются между колонками.

**Ожидаемое поведение:**
- Задачу можно перетащить в другую колонку
- Изменение сохраняется в Supabase
- После обновления страницы задача остается в новой колонке

**Файлы для проверки:**
- `src/widgets/board/ui/Board.tsx` (onDragOver, onDragEnd)
- `src/entities/column/ui/Column.tsx`
- `src/entities/task/ui/TaskCard.tsx`

---

### 2. Создание задач не работает (КРИТИЧЕСКИЙ)

**Проблема:** При нажатии на "+" в колонке задача не создается.

**Ожидаемое поведение:**
- При нажатии на "+" создается новая задача
- Задача появляется в колонке
- Задача сохраняется в Supabase
- После обновления страницы задача остается

**Файлы для проверки:**
- `src/entities/column/ui/Column.tsx` (onClick для Plus)
- `src/hooks/useBoardData.ts` (addTask)
- `src/widgets/board/model/BoardContext.tsx`

---

### 3. Нет редиректа на /login (ВЫСОКИЙ)

**Проблема:** Неавторизованный пользователь попадает на главную страницу вместо страницы логина.

**Ожидаемое поведение:**
- Если `user === null`, редирект на `/login`
- После успешного логина редирект на `/`

**Файлы для проверки:**
- `src/app/page.tsx`

---

### 4. Кнопки навигации не работают (ВЫСОКИЙ)

**Проблема:** Кнопки "Главная", "Все задачи" не меняют состояние приложения.

**Решение:** Либо реализовать функционал, либо временно скрыть кнопки.

**Файлы для проверки:**
- `src/widgets/sidebar/ui/Sidebar.tsx` (handleNavClick)

---

### 5. Команда - фиктивные данные (СРЕДНИЙ)

**Проблема:** Команда показывает "Евгений, Анна, Иван" - это mock-данные.

**Решение:** Либо загрузить из Supabase, либо временно скрыть.

**Файлы для проверки:**
- `src/entities/task/model/store.ts` (mockMembers)
- `src/features/team/ui/TeamModal.tsx`

---

### 6. Статистика из localStorage (ВЫСОКИЙ)

**Проблема:** Статистика в header показывает данные из localStorage, а не из Supabase.

**Ожидаемое поведение:**
- Статистика показывает реальные данные из Supabase
- Прогресс-бар правильный

**Файлы для проверки:**
- `src/app/page.tsx` (useBoardStats)
- `src/entities/task/model/store.ts`

---

### 7. task.tags.map potential crash (СРЕДНИЙ)

**Проблема:** Нет проверки на `undefined` перед `map()`.

**Файлы:**
- `src/entities/task/ui/TaskCard.tsx:103`

**Исправление:** `task.tags?.map()` или `task.tags?.map() ?? []`

---

## Требования к коду

1. **Простота:** Минимум изменений, только необходимое
2. **Тесты:** Написать тесты для исправленного функционала
3. **Все тесты должны проходить** перед пушем
4. **Не быть ленивым:** Найти root cause, не делать временные правки

---

## Критерии успеха

- [ ] Drag & Drop работает между любыми колонками
- [ ] Создание задачи работает
- [ ] Редирект на /login для неавторизованных работает
- [ ] Кнопки навигации либо работают, либо скрыты
- [ ] Статистика показывает данные из Supabase
- [ ] Нет crash на `task.tags.map`
- [ ] Все unit тесты проходят
- [ ] Вручную проверено: все работает

---

## Тестирование

**Обязательные тесты:**
```bash
npm run test        # Unit тесты
npm run dev         # Ручная проверка
```

**Ручная проверка:**
1. Открыть `http://localhost:3000`
2. Создать задачу (нажать +)
3. Перетащить задачу в другую колонку
4. Обновить страницу - задача должна остаться
5. Выйти - должен быть редирект на /login

---

## Ветка работы

**Создать ветку:** `claude/fix-phase-3-bugs`

**После выполнения:**
1. Запушить в GitHub
2. Создать PR (если нужно)
3. Сообщить локальному агенту для проверки

---

## Дополнительная информация

**Supabase проект:** `sqhtukwjmlaxuvemkydn`
**Документация:** `tasks/roadmap-supabase-testing.md`
**Workflow:** `WORKFLOW.md`
